{% extends "partials/base.html" %}
{% load crispy_forms_tags %}
{% block title %}
Product Page
{% endblock %}
{% block content %}
<!--Topside-->
{% include 'partials/topnav.html' %}
<!--End Topside-->
<!--Table-->
<div class="container">
    <div class="row my-4">
        <div class="col-md-4">
            <div class="border bg-white p-3">
                <h4>Add Products</h4>
                <hr>
                <form method="POST">
                    {% csrf_token %}
                    {{ product_form|crispy }}
                    <div class="d-grid">
                        <input type="submit" class="btn btn-success btn-block" value="Add Product">
                    </div>
                </form>
            </div>
        </div>
        <div class="col-md-8">
            <table class="table bg-white">
                <thead class="bg-info">
                    <tr class="text-white">
                        <th scope="col">Name</th>
                        <th scope="col">Category</th>
                        <th scope="col">Quantity</th>
                        <th scope="col">Activity</th>
                    </tr>
                </thead>
                <tbody>
                    {% for asset in assets %}
                    <tr>
                        <td>{{ asset.name }}</td>
                        <td>{{ asset.category }}</td>
                        <td>{{ asset.quantity }}</td>
                        <td>
                            <button 
                                type="button" 
                                class="btn btn-primary btn-sm" 
                                data-bs-toggle="modal" 
                                data-bs-target="#updateProductModal"
                                data-asset-url="{% url 'dashboard-asset-update' asset.id %}"
                                hx-target="#updateProductForm"
                                hx-get="{% url 'dashboard-asset-update' asset.id %}"
                                hx-swap="innerHTML"
                                >Edit
                            </button>
                            <button 
                                type="button" 
                                class="btn btn-danger btn-sm" 
                                data-bs-toggle="modal" 
                                data-bs-target="#deleteProductModal"
                                data-asset-name="{{ asset.name }}"
                                data-asset-url="{% url 'dashboard-asset-delete' asset.id %}"
                                >Delete
                            </button>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

</div>
<div class="modal-container">
    <div class="modal fade" id="deleteProductModal" tabindex="-1" aria-labelledby="modalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h1 class="modal-title fs-5" id="modalLabel">Deleting Product</h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p>Please confirm the deletion of Product <strong id="deleteProductLabel">Sample Product</strong>.</p>
                    <form id="productDeletionForm" method="POST">
                        {% csrf_token %}
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button  type="submit" class="btn btn-danger" form="productDeletionForm">Delete</button>
                </div>
            </div>
        </div>
    </div>
    <div class="modal fade" id="updateProductModal" tabindex="-1" aria-labelledby="modalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h1 class="modal-title fs-5" id="modalLabel">Update Product Details</h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body"> 
                    <form id="updateProductForm" method="POST">
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button  type="submit" class="btn btn-success" form="updateProductForm">Save</button>
                </div>
            </div>
        </div>
    </div>
</div>
<script type="text/javascript">
    const deleteProductModal = document.getElementById('deleteProductModal');
    const updateProductModal = document.getElementById('updateProductModal');

    if (deleteProductModal) {
        deleteProductModal.addEventListener('show.bs.modal', e => {
            const button = e.relatedTarget;
            const productName = button.dataset.productName;
            const productUrl = button.dataset.productUrl;

            const deleteProductLabel = deleteProductModal.querySelector('#deleteProductLabel')
            deleteProductLabel.textContent = productName

            const form = deleteProductModal.querySelector('form')
            form.setAttribute('action', productUrl)
        })
    }

    if (updateProductModal) {
        updateProductModal.addEventListener('show.bs.modal', e => {
            const button = e.relatedTarget;
            const productUrl = button.dataset.productUrl;

            const form = updateProductModal.querySelector('form')
            form.setAttribute('action', productUrl)
        })
    }
</script>
{% endblock %}
